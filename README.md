# Симулятор менеджера такси

## Введение
Это приложение создано для практики работы с потоками. В нём реализовано карта небольшого района, по которой перемещаются такси, выполня заказы из общей очереди заказов.

Графическая часть реализована с помощью библиотеки SDL2 и [обёртки](https://github.com/flibitijibibo/SDL2-CS) которая предоставляет API SDL2 для C#

## Структура
Структура программы разделена на две части:

1. Графическая часть
   1. Базовый класс окна - в нём реализован цикл отрисовки и рендерер
      1. Главное окно с картой
      2. Окно ручного создания заказов
      3. Окно управления такси
   2. Ренедерер, который упращает отрисовку примитивов
2. Логическа часть
   1. Менеджер такси
   2. Такси

## Реализованый функционал

1. Такси:
   - Передвижение по маршруту
   - Расчёт времени пути до заказа и времени выполнения заказа
   - Приём нового заказа от менеджера такси
2. Менеджер такси
   - Формирование неориентированного взвешеного графа-карты из двух json файлов с вершинами и рёбрами
   - Создание объектов такси и их запуск в отдельном окне
   - Создание главного окна с картой, создаёться в отдельном потоке
   - Запуск потока создания/распределения заказов для такси
3. Окно управления такси
   - Изменения скорости такси в реальном времени
   - Отображение статуса такси(простой, на пути к заказу, на заказе)
4. Окно ручного создания заказов
   - Выбор двух точек, начальной и конечной
   - Добавление в очередь нового заказа
5. Главное окно с картой
   - Отображение карты
   - Переключение видимости вершин графа
   - Переключение генератора заказа
   - Отображение такси
   - Отображение текущих маршрутов такси
   - Отображение количества заказов в очереди

## Реализация графики

### Лирическое отступление

SDL(Simple DirectMedia Layer) - это [на Вики всё написано](https://ru.wikipedia.org/wiki/Simple_DirectMedia_Layer), она настолько Simple что в основной части реализована отрисовка лишь нескольких примитивов и работа с текстурами. В целом от этой библиотеки большего и не надо, так как она обычно используеться в тандеме с OpenGL предоставляя удобный доступ к переферии. Но так как мне не хотелось разбираться ещё и с OpenGL и слепливать докучи обе технологии, некоторый отсутсвующий функционал в SDL я реализовал из приметивов SDL. Перейдём к этому.

### PlushRenderer

Рендерер с милым названием, но всё же упрощающий отрисовку основных геометрических фигур. Так как обычно в SDL нужно менять цвет отрисовки отдельно от вызова отрисовки, я объеденил это вместе. И так что есть в этом рендерере

1. Прямоугольник - всё как в SDL, залитый и не залитый
2. Правильный многоугольник - достаточно медленная отрисовка из-за вычислений тригонометрических функций на процессоре. Заливка осуществляется рекурсивно, что ещё медленнее
3. Круг и окружность - как правильный многоугольник только с очень большим количевством вершин, как вы понимаете, это ещё больше бьёт по производительности.
4. Линния и массив линий - операции по нахождению перпендикуляра, рекурсия и прочее. Производительность здесь то же страдает
5. Текст - использует модуль SDL_ttf, о котором будет в отдельном пункте. В каждом рендерере шрифты хранятся локально, это немного неудобно, но пока сойдёт.

Из более "навороченых" объектов есть кнопка, которая представляет собой прямоугольник и надпись, с функцией-проверкой клика по ней. Там есть неоторые ограничения, в виде не изменяемого цвета текста, делал наспех и было просто лень.

### Немного про модули

В репозитории NuGet лежит собраный форк библиотеки от [flibitijibibo](https://github.com/flibitijibibo/). Я не знаю как его там собирали, но в моём случае в нём не были доступны все дополнительные модули. Чтобы это исправить, нужно самому собрать эту библиотеку под свою платформу(в моём случае винда x64 и .NET 8.0). Так как это всего лишь бинды для библиотеки, то нужно найти бинарники самой библиотеки. С SDL_ttf проблем не возникло, но вот SDL_gfx, который помог бы обойтись без OpenGL и отрисовывать круги и другие отсутсвующих примитивов в SDL силами SDL_gfx. Но библиотека очень древняя и есть поддержка только SDL версии 1.2 в общем попытки собрать это не увенчались успехом. Возможно потом найду либо другую библиотеку предоставляющую биндинги, либо прикручу OpenGL к текущему